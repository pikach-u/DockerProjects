apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-deployment
  labels:
    app: webapp
spec:
  replicas: 3 # 3ê°œì˜ Pod ìƒì„±
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
        - name: webapp
          image: nginx:alpine
          ports:
            - containerPort: 80
          env:
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
          command: ["/bin/sh"]
          args:
            - -c
            - |
              # ê° Podë§ˆë‹¤ ê³ ìœ í•œ ìƒ‰ìƒê³¼ ì •ë³´ë¥¼ ê°€ì§„ HTML ìƒì„±
              POD_ID=$(echo $POD_NAME | cut -d'-' -f3)

              # Podë³„ë¡œ ë‹¤ë¥¸ ìƒ‰ìƒ ì„¤ì •
              case $POD_ID in
                *1|*4|*7) COLOR="#e74c3c"; POD_COLOR="ë¹¨ê°•";;
                *2|*5|*8) COLOR="#3498db"; POD_COLOR="íŒŒë‘";;
                *3|*6|*9) COLOR="#2ecc71"; POD_COLOR="ì´ˆë¡";;
                *0) COLOR="#f39c12"; POD_COLOR="ì£¼í™©";;
                *) COLOR="#9b59b6"; POD_COLOR="ë³´ë¼";;
              esac

              cat > /usr/share/nginx/html/index.html << EOF
              <!DOCTYPE html>
              <html lang="ko">
              <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>ğŸš€ Kubernetes ë¡œë“œë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸</title>
                  <style>
                      body {
                          font-family: Arial, sans-serif;
                          max-width: 800px;
                          margin: 30px auto;
                          padding: 20px;
                          background: linear-gradient(135deg, $COLOR, #2c3e50);
                          color: white;
                          border-radius: 15px;
                          text-align: center;
                      }
                      .container {
                          background: rgba(255,255,255,0.1);
                          padding: 40px;
                          border-radius: 20px;
                          backdrop-filter: blur(10px);
                      }
                      .pod-info {
                          background: rgba(255,255,255,0.2);
                          padding: 20px;
                          margin: 20px 0;
                          border-radius: 10px;
                          font-size: 18px;
                      }
                      .highlight {
                          background: $COLOR;
                          padding: 5px 15px;
                          border-radius: 25px;
                          display: inline-block;
                          margin: 5px;
                          font-weight: bold;
                      }
                      .instruction {
                          background: rgba(255,255,255,0.15);
                          padding: 15px;
                          border-radius: 8px;
                          margin: 15px 0;
                          font-size: 16px;
                      }
                      .refresh-btn {
                          background: #27ae60;
                          color: white;
                          border: none;
                          padding: 15px 30px;
                          font-size: 18px;
                          border-radius: 8px;
                          cursor: pointer;
                          margin: 10px;
                      }
                      .refresh-btn:hover {
                          background: #2ecc71;
                      }
                  </style>
              </head>
              <body>
                  <div class="container">
                      <h1>ğŸš€ Kubernetes ë¡œë“œë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸</h1>

                      <div class="pod-info">
                          <h2>í˜„ì¬ ì‘ë‹µí•˜ëŠ” Pod ì •ë³´</h2>
                          <p><strong>Pod ì´ë¦„:</strong> <span class="highlight">$POD_NAME</span></p>
                          <p><strong>Pod IP:</strong> <span class="highlight">$POD_IP</span></p>
                          <p><strong>Pod ìƒ‰ìƒ:</strong> <span class="highlight">$POD_COLOR</span></p>
                      </div>

                      <div class="instruction">
                          <h3>ğŸ“ ë¡œë“œë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸ ë°©ë²•</h3>
                          <p>1. ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”</p>
                          <p>2. ë§¤ë²ˆ ë‹¤ë¥¸ Podì—ì„œ ì‘ë‹µí•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì„¸ìš”</p>
                          <p>3. Pod ì´ë¦„, IP, ìƒ‰ìƒì´ ë°”ë€ŒëŠ” ê²ƒì„ ê´€ì°°í•˜ì„¸ìš”</p>
                      </div>

                      <button class="refresh-btn" onclick="location.reload()">
                          ğŸ”„ ìƒˆë¡œê³ ì¹¨ (ë¡œë“œë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸)
                      </button>

                      <div class="instruction">
                          <p><strong>í˜„ì¬ ì‹œê°„:</strong> $(date)</p>
                          <p><strong>ì´ Pod ê°œìˆ˜:</strong> 3ê°œ</p>
                          <p><strong>ì„œë¹„ìŠ¤ íƒ€ì…:</strong> ClusterIP (ë¡œë“œë°¸ëŸ°ì‹±)</p>
                      </div>
                  </div>
              </body>
              </html>
              EOF

              # nginx ì‹œì‘
              nginx -g 'daemon off;'
          resources:
            requests:
              memory: "32Mi"
              cpu: "25m"
            limits:
              memory: "64Mi"
              cpu: "50m"
---
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
spec:
  selector:
    app: webapp
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: NodePort
